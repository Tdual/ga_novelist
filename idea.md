# 📖 即時進化型小説サービス構想（4 ルーム／選択式／常時進化）

## コンセプト

- 小説は **常に進化し続ける存在**。
- ユーザーは「もっと〇〇っぽく」ボタンを押すだけ。
- クリックされた瞬間に小説が更新され、ストーリーが変化する。
- 投票や多数決は不要。
- 4 つのルームが同じ初期文からスタートし、ユーザーの選択だけで自然分岐していく。
- **セッションの区切りはなく**、いつでも「今の完成形」をその場で読むことができる。

---

## 基本フロー

1. **初期文を全ルームに提示**

   - 例：「暗い森の奥で、少年は小さな光を見つけた。」

2. **操作方法**

   - 画面に 10 個程度の「もっと〇〇っぽく」ボタンが並ぶ。
   - 例：「もっとホラー」「もっとロマンス」「もっと SF」「もっとコメディ」「もっと詩的に」「もっとセリフを増やす」「もっと舞台を変える」「もっとキャラを増やす」「もっと混沌」「もっとスピード感を」

3. **即時反映**

   - ボタンが押された瞬間に、そのルームの文章が更新される。
   - 投票ではなく、押した人の選択がそのまま「正史」になる。

4. **進化の綱引き**

   - ユーザーが増えるほど方向性が混ざり合い、ホラーとロマンスが同居したり、SF にコメディが挿入されたりする。
   - ルームごとに異なる集合知が働き、4 本の小説がリアルタイムで変化していく。

---

## 常時進化型の特徴

- **セッション終了は存在しない**。
- ユーザーはいつでも「その時点の完成形」を読むことができる。
- 小説は流れ続ける川のように変化し続け、止まらない。
- 読者は「いまこの瞬間の物語」と「数分前の物語」の違いを楽しめる。

---

## リアルタイム演出

- **現在の本文表示**：常に最新の完成テキストを表示。
- **進化ログ**：サイドバーに「◯◯ さんが“もっとホラー”を選択 → “闇の影が忍び寄る”に更新」と履歴を残す。
- **血統図**：どのクリックがどんな変化をもたらしたかをツリーで可視化。
- **世代バー**：クリックの回数＝世代数としてカウントし、進化のスピード感を見せる。

---

## 出力物

- 「現在の小説」＝常に最新のテキスト。
- 任意のタイミングで **スナップショット保存** 可能。

  - 保存時には「直近 100 クリックの履歴」と共に出力。

- 結果として「進化し続ける 1 本の小説」＋「瞬間瞬間の保存版」が得られる。

---

## 面白さのポイント

- **即時性**：1 クリックで文章が変わる → 自分の行動の影響が即わかる。
- **綱引き**：多数派・少数派が混ざり合い、物語が思わぬ方向に進む。
- **並行進化**：4 ルーム同時進行で、同じ始まりが全く違う形に育つ。
- **終わりがない**：いつでも最新を楽しめ、履歴を追えば“過去の異なる世界線”も楽しめる。

# 🛠️ 技術スタックと実現イメージ

## バックエンド（Julia）

- **フレームワーク**：Oxygen.jl

  - HTTP API（`POST /rooms/{id}/nudge` など）
  - SSE or WebSocket によるリアルタイム配信

- **進化エンジン**：Evolutionary.jl

  - 遺伝子表現（文体、舞台、キャラ数、セリフ比率など）
  - オペレーター（「もっとホラー」「もっとロマンス」など）を **突然変異＋制約変更** として実装
  - 選択操作は不要（クリック＝直接確定）

- **状態管理**

  - 最新の genome ＋ current_text を `rooms` テーブルに保持
  - 操作ログを `nudges` に保存（誰がどのボタンを押したか）
  - スナップショットを定期保存（任意で履歴再生に使える）

## フロントエンド（Svelte）

- 各ルームの画面

  - 現在の小説テキスト表示（常に最新）
  - 「もっと〇〇っぽく」ボタン群（10 個程度）
  - サイドに「進化ログ」や「世代バー」

- リアルタイム更新

  - SSE/WS で受信した更新を即反映
  - クリック操作は `fetch('/rooms/{id}/nudge', {operator})` でサーバへ送信

## データベース

- シンプルな RDB（PostgreSQL／SQLite）で十分

  - `rooms(id, current_genome, current_text, generation, updated_at)`
  - `nudges(id, room_id, operator_id, actor, new_genome, created_at)`
  - `snapshots(id, room_id, generation, text, created_at)`

## リアルタイム挙動

1. ユーザーが「もっと〇〇っぽく」をクリック
2. `POST /rooms/{id}/nudge` が呼ばれる
3. Oxygen.jl が Evolutionary.jl に渡して genome を更新
4. Renderer が genome → テキスト変換
5. DB 更新 & SSE/WS で全クライアントに即配信
6. Svelte 側で即描画更新

---

# 🎛️ なぜこの構成か

- **Julia**：GA の実験や突然変異・表現のカスタマイズに強い。
- **Oxygen.jl**：軽量でリアルタイム API と相性が良い。
- **Svelte**：リアクティブな UI で「クリック即変化」を直感的に表現できる。

---

つまり、

- バックエンド：**Julia で「遺伝子処理」＋「API 配信」**
- フロント：**Svelte で「ボタン操作」＋「リアルタイム表示」**
- ストレージ：**簡易 DB で履歴保持とスナップショット管理**

これで「4 ルーム／常時進化／即時反映」のサービスが成り立ちます。
